# HealthConnect - Audit Hub Service (Python)

The **Audit Hub Service** is a lightweight, asynchronous microservice built with **FastAPI**. It acts as the central nervous system for traceability within the **HealthConnect** ecosystem, consuming and persisting every critical event generated by other microservices.

## üìä Event-Driven Traceability

This service is designed to handle high volumes of logs without blocking business logic, using an asynchronous consumer architecture:

1.  **Asynchronous Consumption:** Utilizes a dedicated background thread to listen to **RabbitMQ** queues, ensuring that log ingestion does not impact API responsiveness.
2.  **JSONB Persistence (CDC Ready):** Stores event metadata in PostgreSQL using `JSONB` columns. This allows for **Change Data Capture (CDC)** patterns, storing snapshots of records **before** and **after** modifications for deep forensic auditing.
3.  **Cross-Platform Integration:** Decodes and normalizes events sent from diverse stacks (Java/Spring Boot and Go), providing a unified view of the system's activity.

## üöÄ Technology Stack

* **Python 3.11+**
* **FastAPI:** Modern, high-performance web framework for building APIs.
* **SQLAlchemy:** Powerful SQL toolkit and ORM for Python.
* **Pika:** Pure-Python implementation of the AMQP 0-9-1 protocol for RabbitMQ.
* **Pydantic Settings:** Strict environment variable validation and management via `.env`.
* **PostgreSQL:** Chosen for its robust JSONB support and indexing capabilities.



## üèóÔ∏è Technical Highlights

* **Lifespan Management:** Uses FastAPI Lifespan events to manage the background worker's lifecycle, ensuring clean startups and graceful shutdowns.
* **Modular Architecture:** Separation of concerns between the API layer, the database models, and the RabbitMQ worker services.
* **Non-Blocking I/O:** Engineered to scale horizontally; multiple instances can consume from the same queue to distribute the auditing load.
* **Flexible Schema:** The use of `JSONB` allows the system to evolve without requiring constant database migrations when other services add new metadata fields.

## üõ†Ô∏è Configuration & Installation

### Prerequisites
* Python 3.11 or higher
* RabbitMQ Server
* PostgreSQL 14+

### Environment Variables (.env)
```env
DATABASE_URL=postgresql://user:pass@192.168.0.4:5432/audit_db
RABBITMQ_HOST=192.168.0.4
RABBITMQ_QUEUE=audit_queue
APP_PORT=8000


`
docker run -d
  --name healthconnect-audit-hub
  --network healthconnect-net
  -p 8000:8000
  -e DATABASE_URL=postgresql://postgres:1234@postgresdb-prod-01:5432/audit_db
  -e RABBITMQ_HOST=healthconnect-queue
  -e RABBITMQ_QUEUE=audit_queue
  -e APP_PORT=8000
  healthconnect-audit-hub-service:1.0.0
`